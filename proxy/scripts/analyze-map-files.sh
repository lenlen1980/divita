#!/bin/bash

echo "=== Анализ проблемы с .map файлами ==="
echo ""

echo "1. ЧТО ТАКОЕ .map ФАЙЛЫ:"
echo "   - Source map файлы для отладки JavaScript"
echo "   - Позволяют видеть исходный код вместо минифицированного"
echo "   - Используются только в DevTools браузера"
echo ""

echo "2. СТАТИСТИКА ОШИБОК:"
total_errors=$(grep -c "\.mjs\.map" /var/www/html/proxy/logs/error.log)
echo "   Всего ошибок 404 для .map файлов: $total_errors"

echo ""
echo "3. ВЛИЯНИЕ НА ПОЛЬЗОВАТЕЛЕЙ:"
echo "   - На функциональность сайта: НЕ ВЛИЯЕТ ✓"
echo "   - На производительность: НЕ ВЛИЯЕТ ✓"
echo "   - На SEO: МОЖЕТ ВЛИЯТЬ (много 404 ошибок) ⚠️"
echo "   - На логи сервера: ЗАСОРЯЕТ ЛОГИ ⚠️"
echo ""

echo "4. ПОЧЕМУ Я ОШИБОЧНО НАЗВАЛ ИХ НЕКРИТИЧНЫМИ:"
echo "   ✗ Не учел влияние на SEO"
echo "   ✗ Не учел нагрузку на сервер от лишних запросов"
echo "   ✗ Не учел засорение логов"
echo ""

echo "5. РЕКОМЕНДАЦИИ:"
echo "   1) Создать заглушки для .map файлов"
echo "   2) Или настроить nginx игнорировать эти запросы"
echo "   3) Или найти и загрузить оригинальные .map файлы"

# Проверим, откуда идут запросы
echo ""
echo "6. ИСТОЧНИКИ ЗАПРОСОВ .map ФАЙЛОВ:"
grep "\.mjs\.map" /var/www/html/proxy/logs/access.log | tail -5 | awk '{print "   IP: " $1 " UserAgent: " substr($0, index($0,$12))}'
